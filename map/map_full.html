
<!-- JQuery -->
<script src="jquery-1.10.2.min.js"></script>

<!-- Leaflet stuff -->
<link rel="stylesheet" href="leaflet.css" />
<script src="leaflet.js"></script>

<!-- Leaflet Label plugin -->
<script src='leaflet.label.js'></script>
<link href='leaflet.label.css' rel='stylesheet' />

<!--settings for full-screen map, from: http://bl.ocks.org/d3noob/7654694 -->
<style>
body {
    padding: 0;
    margin: 0;
}
html, body, #map {
    height: 100%;
    width: 100%;
}
</style>

<!-- LeafLet map  - relative link -->
<div id="map"></div>
<!-- places.geojson -->
<link rel="points" type="application/json" href='spam_places.geojson'>

<script>
    // create map
    var map = L.map('map').setView([-15, -55], 4);

    // MapBox Terrain - zooms 5-18
    MBTerrain = L.tileLayer('http://{s}.tiles.mapbox.com/v3/carlosgrohmann.ibb4756i/{z}/{x}/{y}.png', {
            maxZoom: 18,
            minZoom: 0,
            attribution: '&copy; Tiles Courtesy of <a href="https://www.mapbox.com" title="MapBox" target="_blank">MapBox</a>',
            }).addTo(map);  

    // color itens coording to properties
    function getColor(category) {
        return category == "meeting"  ?   '#002E63' : 
               category == "research" ?   '#FF7E00' :
                                          '#000';
    }

    // Attaching a GeoJSON file with relative link: (from: http://lyzidiamond.com/posts/osgeo-august-meeting/)
      $.getJSON($('link[rel="points"]').attr("href"), function(data) {
        var geoJsonLayer = L.geoJson(data, {
            onEachFeature: function (feature, layer) {
                //https://plnkr.co/edit/TwAuI90IIJzyEJU8iGSu?p=preview
                var div_element = document.createElement("div");
                var p_element = document.createElement("p");
                // p_element.innerHTML = "Theme: " + feature.properties.Theme +"<br>"
                p_element.innerHTML = "Project: " + feature.properties.Proj_title +"<br>"
                p_element.innerHTML += "Spammer: " + feature.properties.Proj_person +"<br>"
                var a_element = document.createElement("a");
                a_element.href = feature.properties.Proj_link
                a_element.target = "_blank"
                a_element.innerHTML = "More info"
                p_element.appendChild(a_element)
                div_element.appendChild(p_element)
                // var content = feature.properties.Proj_title + '<br>' + feature.properties.Proj_person + '<br>' + p_element
                // var desc = feature.properties.Title
                // layer.bindLabel(content)
                layer.bindPopup(div_element)
            },
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, {
                radius: 5,
                Label: getColor(feature.properties.Title), 
                fillColor: getColor(feature.properties.category), 
                color: "#000",
                weight: 0.5,
                opacity: 0.8,
                fillOpacity: 0.7,})
            },
        });
        geoJsonLayer.addTo(map);
      });
</script>

